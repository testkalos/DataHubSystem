<p>&nbsp;</p>
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.dropotron.min.js"></script>
<script src="assets/js/skel.min.js"></script>
<script src="assets/js/skel-layers.min.js"></script>
<script src="assets/js/init.js"></script>
<noscript>
            &amp;lt;link rel="stylesheet" href="assets/css/skel.css" /&amp;gt;
            &amp;lt;link rel="stylesheet" href="assets/css/style.css" /&amp;gt;
            &amp;lt;link rel="stylesheet" href="assets/css/style-wide.css" /&amp;gt;
        </noscript><!-- Header -->
<div id="header">
<h1>Admin API</h1>
</div>
<section class="wrapper style1">
<div class="container">
<div id="content">
<article>
<p align="justify">Introduction...</p>
<p align="justify">1. User connection information inspection via OData protocol <br /> 2. User Synchronization<br /> 3. Products deletion</p>
<h2>User connection information inspection via OData protocol</h2>
<p align="JUSTIFY">The procedure shows in detail all steps needed to visualize the information about users and their connections through OData.</p>
<p align="justify">&nbsp;</p>
<p align="justify"><strong> STEP 1: </strong> Stop DHuS <br /> Add to the server.xml file the following lines:<br /> <span style="color: #0000ff;"> &lt; Valve className="fr.gael.dhus.server.http.valve.AccessValve" pattern=".* useLogger="true" enable="true"/&gt; </span><br /> Start DHuS</p>
<p align="justify"><strong> STEP 2:</strong></p>
<p align="justify">Log in as administrator (root)</p>
<p align="justify"><strong> STEP 3:</strong><br /> Access the following link:<br /> <span style="color: #0000ff;"> https://DHuS_URL/odata/v1/Users?$orderby=Username</span> <br /> Verify that the list of users is visible and it is sorted depending on the username</p>
<p align="justify">The following information relative to each user is visualized:</p>
<pre><code>&lt;m:properties&gt;
&lt;d:Username&gt; 
&lt;d:Email&gt;
&lt;d:FirstName&gt;
&lt;:LastName&gt;
&lt;d:Country&gt;
&lt;d:Phone/&gt;
&lt;d:Address/&gt;
&lt;d:Domain&gt;
&lt;d:SubDomain&gt;
&lt;d:Usage&gt;
&lt;d:SubUsage&gt;unknown&lt;/d:SubUsage&gt;
&lt;/m:properties&gt;
&lt;/content&gt;;</code></pre>
<p align="justify">The users are sorted depending on the username.</p>
<p align="justify"><strong> STEP 4: </strong></p>
<p align="justify">Verify that the number returned by the URL:</p>
<p align="justify"><span style="color: #0000ff;"> https:// DHuS_URL /odata/v1/Users/$count?</span></p>
<p align="justify">Is equal to the total number of users registered to the Hub (The total number of users is visible from the GUI under management-&gt;Users)</p>
<p align="justify">The number of users is the same.</p>
<p align="justify"><strong> STEP 5: </strong></p>
<p align="justify">Log in with as a general user (search, download) and access the following URL:</p>
<p align="justify"><span style="color: #0000ff;"> https://DHuS_URL/odata/v1/Users?$filter= $filter=Username eq &lsquo;Username&rsquo;</span></p>
<p align="justify">The User information about the user are visualised. When refreshing the page pushing the F5 button, the field &ldquo;updated&rdquo; is updated with the current time.</p>
<p align="justify"><strong> STEP 6:</strong></p>
<p align="justify">Access the Node:</p>
<p align="justify"><span style="color: #0000ff;"> https://DHuS_URL/odata/v1/Users(&lsquo;Username&rsquo;)/Connections </span></p>
<p align="justify">All the URL accessed by the user are listed. For each connection the following info are displayed:</p>
<pre><code>
&lt;entry&gt;
&lt;id&gt;
&lt;title 
&lt;updated&gt;
&lt;m:properties&gt;
&lt;d:Id&gt;
&lt;d:Date&gt;
&lt;d:RemoteIp&gt;
&lt;d:Request&gt;
&lt;d:Duration&gt;
</code>
</pre>
<p align="justify"><strong> STEP 7: </strong></p>
<p align="justify">Once logged in as administrator, access the URL:</p>
<p align="justify"><span style="color: #0000ff;"> https://DHuS_URL/odata/v1/Users(&lsquo;root&rsquo;)/SystemRoles </span></p>
<p align="justify">to visualize the user roles of the administrator user</p>
<p align="justify">The administrator has everyrole available on the Hub:</p>
<p align="justify">&bull;Search</p>
<p align="justify">&bull;Upload</p>
<p align="justify">&bull;Archive manager</p>
<p align="justify">&bull;Statistics</p>
<p align="justify">&bull;System manager</p>
<p align="justify">&bull;Data manager</p>
<p align="justify">&bull;Download</p>
<p align="justify"><strong> STEP 8:</strong></p>
<p align="justify">Access the URL:</p>
<p align="justify"><span style="color: #0000ff;"> https://DHuS_URL/odata/v1/Networks(0L)/NetworkStatistic </span></p>
<p align="justify">To visualize the statistics associated to the network.</p>
<p align="justify">The NetworkStatistics reports the informations related to the statistics of the network (activity period in ms, number of connection within this period).</p>
<p>&lt;id&gt; https://scihub-test.esa.int/dhus/odata/v1/Networks(0L)/NetworkStatistics(0L)</p>
<pre><code>

&lt;title type="text"&gt;0
&lt;updated&gt; 2016-02-25T15:32:12.613Z &lt;/updated&gt;
&lt;category term="DHuS.NetworkStatistic"  &lt;scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme"/gt;
&lt;link href="NetworkStatistics(0L)" rel="edit" title="NetworkStatistic"/&gt;
&lt;content type="application/xml"&gt;
&lt;m:properties&gt;
&lt;d:Id&gt;0 &lt;/d:Id&gt;
&lt;d:ActivityPeriod&gt;
&lt;d:ConnectionNumber&gt;&lt;/m:properties&gt;
&lt;/content&gt;
&lt;/entry&gt;
</code></pre>
<p align="justify"><strong> STEP 9:</strong></p>
<p align="justify">Access the URL:</p>
<p align="justify"><span style="color: #0000ff;"> https://[dhus]/dhus/odata/v1/Connections?$filter=substringof(Request,'odata/v1')</span></p>
<p align="justify">to visualize all the odata queries performed by the users.All the odata queries performed by the users are visualized</p>
<p align="justify"><strong> STEP 10:</strong></p>
<p align="justify">Launch a product download via GUI.Access the URL:</p>
<p align="justify"><span style="color: #0000ff;"> https://[dhus]/odata/v1/Connections?$filter=Status eq 'PENDING'</span></p>
<h2>User Synchronization via API</h2>
<p align="justify"><strong> STEP 1:</strong> Log in the machine where the Front End (FE) DHuS is installed. This DHuS instance shall be filled with users registered in the Back End (BE).</p>
<p align="justify"><strong> STEP 2:</strong>On the DHuS acting as FE, set the environment variables to connect to the syncing instance of the DHuS.</p>
<p align="justify"><span style="color: #0000ff;">Example:</span></p>
<pre><code>
export DHOST=localhost:8080
export DLOGIN=root
export DPASS=a
	</code></pre>
<p align="justify"><span style="color: #0000ff;">Doing the commands:</span></p>
<pre><code>
echo $DHOST
echo DLOGIN
echo DPASS
</code></pre>
<p align="justify"><span style="color: #0000ff;">the correspondent values are displayed</span></p>
<p align="justify"><strong> STEP 3: </strong> Create a working folder containing the following scripts and auxiliary files:</p>
<p>&bull; ./getSynchronizer</p>
<p>&bull; ./createSynchronizer</p>
<p>&bull; Body.txt</p>
<p>&bull; ./updateSynchronizer</p>
<p>&bull; ./deleteSynchronizer</p>
<p align="justify">Available on <a href="https://github.com/jobayle/dhus_user_sync_scripts"> https://github.com/jobayle/dhus_user_sync_scripts</a></p>
<p align="justify"><strong> STEP 4: </strong> Use the command: ./getSynchronizer [id] (if no user synchronizer is available, launchr this command with no id in input) The information regarding the currently available user synchronizer are displayed.</p>
<p align="justify"><strong> STEP 5: </strong> Create the user synchronizer use the command:</p>
<pre>	<code>
./createSynchronizer &lt;-D_SCHEDULE=...&gt; &lt;-D_REQUEST=start|stop&gt; &lt;-D_SERVICEURL=...&gt; [-D_LABEL=...] [-D_SERVICELOGIN=...] [-D_SERVICEPASSWORD=...]</code></pre>
<p align="justify">(Example:</p>
<pre><code>
<code>
. /createSynchronizer -D_SCHEDULE="0 */3 * * * ?" -D_REQUEST=stop -D_SERVICEURL="http://192.168.0.105:8080/odata/v1" 
-D_LABEL=my_user_syncer -D_SERVICELOGIN=root -D_SERVICEPASSWORD=a)
</code></code></pre>
<p align="justify">Performing again the command in step 4 of this procedure, the characteristic of the user sync are displayed.</p>
<pre><code> 
Update the user synchronizer through the following commands:</code></pre>
<p align="justify"><strong> STEP 6: </strong> ./updateSynchronizer [-D_SCHEDULE=...] [-D_REQUEST=start|stop] [-D_SERVICEURL=...] [-D_LABEL=...] [-D_SERVICELOGIN=...] [-D_SERVICEPASSWORD=...] (e.g. ./updateSynchronizer 0 -D_SCHEDULE='0 24 * * * ?')</p>
<p align="justify">Performing again the command in step 4 of this procedure, the characteristic of the user sync are displayed updated as requested.</p>
<p align="justify"><strong> STEP 7: </strong> Delete the synchronizer using the following command: <code> ./deleteSynchronizer &lt;id&gt; </code></p>
<p align="justify">Performing again the command in step 4 of this procedure, the characteristic of the user sync are no longer available.</p>
<h2>Products Deletion</h2>
<p align="JUSTIFY">The following scripts permit massive products deletion via API.</p>
<p align="justify">&bull; <strong>getID.sh</strong>: it produces the UUID of products retrieving this information from the specified product names</p>
<p align="justify">&bull; <strong> delete_mod.sh</strong>: it performs the deletion of the products listed in the getID.sh script.</p>
<p align="justify">The script getID.sh has 3 input parameter:</p>
<p align="justify">1) original file containing names of products to be deleted;</p>
<p align="justify">2) number N of files in which you want to split the original file (used when the number of products is high)</p>
<p align="justify">3) folder containing DB (in-operation DB copy) on which will be performed the query, that get the UUID of products by their names</p>
<p align="justify">For each i-th file (i=1,2,3,.....,N) the query, related to the products names of the i-th file, is built and performed. The split operation allows to delete a big number of products by more scripts (i=1,2,3,......,N) launched in parallel, one for each i-th UUID file.</p>
<p align="justify">The output main files produced by getID.sh are:</p>
<p align="justify">1) UUID_</p>
<p align="justify">{i}.txt i=1,2,3,....,N; file containing the UUID of products of i-th block of names</p>
<p align="justify">2) PRODUCTSNOTFOUND_{i} .txt i=1,2,3,....,N; file containing the names of products not found by i-th query on DB</p>
<p align="justify">Each UUID_ {i}.txt file is the input parameter of the script delete_mod.sh that performs the deletion of UUID on Virtual machine where it is launched.</p>
<p align="justify">The input parameter of the script delete_mod.sh are:</p>
<p align="justify">1) number of deletions in parallel</p>
<p align="justify">2) file containing the UUID to be deleted (UUID_{i} .txt)</p>
<p align="justify">The deletion of single UUID product (CURL command) and the related log is produced by del_prod_mod.sh that is a script present in delete_mod.sh. If the log produces, for a specific UUID, the string "in XXX s return code 20..." the product is deleted.</p>
</article>
</div>
</div>
</section>
